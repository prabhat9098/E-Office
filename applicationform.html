<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Application Form | E-Office Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body, html {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f8f9fa;
    }

    .header {
      height: 70px;
      background-color: #fff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 999;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .sidebar {
      width: 220px;
      background: #343a40;
      color: white;
      height: 100vh;
      position: fixed;
      top: 70px;
      left: 0;
      padding-top: 20px;
    }

    .sidebar .nav-link {
      color: #adb5bd;
      padding: 12px 20px;
      display: flex;
      align-items: center;
    }

    .sidebar .nav-link i {
      margin-right: 10px;
      font-size: 1.2rem;
    }

    .sidebar .nav-link:hover, .sidebar .nav-link.active {
      background: #495057;
      color: white;
    }

    .main-content {
      margin-left: 220px;
      margin-top: 90px;
      padding: 30px;
    }

    .form-section {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .form-title {
      margin-bottom: 25px;
      font-weight: 600;
      font-size: 1.3rem;
    }

    .language-selector {
      width: 200px;
    }

    @media (max-width: 768px) {
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      .sidebar {
        display: none;
      }
    }
  </style>
</head>
<body>

<!-- Header -->
<div class="header">
    <div class="d-flex align-items-center">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQYiFdEW56wVH-LUuoUp7CmFzybzsFrSKDAOg&s" height="50" class="me-2" />
      <h5 class="mb-0" data-translate="dashboardTitle">E-Office Management</h5>
    </div>
    <div class="d-flex align-items-center gap-3">
      <select id="languageSelect" class="form-select form-select-sm">
        <option value="en" data-translate="English">English</option>
        <option value="hi" data-translate="हिन्दी">हिन्दी</option>
        <option value="mr" data-translate="मराठी">मराठी</option>
      </select>
      <div class="dropdown">
        <i class="bi bi-person-circle fs-3" data-bs-toggle="dropdown" style="cursor: pointer;"></i>
        <ul class="dropdown-menu dropdown-menu-end">
          <!-- <li><a class="dropdown-item" href="#">Profile</a></li> -->
        <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
        </ul>
      </div>
    </div>
  </div>

<!-- SIDEBAR -->
<div class="sidebar">
    <a href="dashboard.html" class="nav-link d-flex align-items-center ">
      <i class="bi bi-house-door-fill me-2 fs-5"></i> 
      <span data-translate="dashboard">Dashboard</span>
    </a>
    <a href="adduser.html" class="nav-link d-flex align-items-center">
      <i class="bi bi-person-plus-fill me-2 fs-5"></i> 
      <span data-translate="addUser">Add User</span>
    </a>
    <a href="applicationform.html" class="nav-link d-flex align-items-center active">
      <i class="bi bi-folder-fill me-2 fs-5 "></i> 
      <span data-translate="applicationForm">Application Form</span>
    </a>
    <a href="applications.html" class="nav-link d-flex align-items-center">
      <i class="bi bi-file-earmark-text me-2 fs-5"></i> 
      <span data-translate="applications">Applications</span>
    </a>
  </div>

<!-- MAIN CONTENT -->
<div class="main-content">
  <div class="form-section">
    <div class="form-title" data-translate="submitApplication">Submit New Application</div>

    <form id="appForm">
      <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label" data-translate="applicationID">Application ID</label>
          <input type="text" class="form-control" id="appId" readonly>
        </div>
        <div class="col-md-3">
            <label class="form-label" data-translate="applicationDate">Date</label>
            <input type="date" class="form-control" id="date" required>
        </div>
        <div class="col-md-3">
            <label class="form-label" data-translate="applicationTime">Time</label>
            <input type="time" class="form-control" id="time" required>
        </div>

        <div class="col-md-6">
            <label class="form-label" data-translate="applicantName">Name of Applicant</label>
            <input type="text" class="form-control" id="applicantName" required>
        </div>

        <div class="col-md-6">
            <label class="form-label" data-translate="contactNumber">Contact Number</label>
            <input type="tel" class="form-control" id="phone" required>

        </div>

        <div class="col-md-12">
            <label class="form-label" data-translate="subject">Subject</label>
            <input type="text" class="form-control" id="subject" required>
        </div>

        <div class="col-md-12">
            <label class="form-label" data-translate="address">Address</label>
            <textarea class="form-control" id="address" rows="2" required></textarea>

        </div>

        <div class="col-md-6">
            <label class="form-label" data-translate="category">Category</label>
            <select class="form-select" id="category" required>
                <option disabled selected data-translate="selectCategory">Select Category</option>
                <option data-translate="complaint">Complaint</option>
                <option data-translate="request">Request</option>
                <option data-translate="suggestion">Suggestion</option>
            </select>
        </div>

        <div class="col-md-6">
            <label class="form-label" data-translate="department">Department</label>
            <select class="form-select" id="department" required>
                <option disabled selected data-translate="selectDepartment">Select Department</option>
                <option data-translate="education">Education</option>
                <option data-translate="health">Health</option>
                <option data-translate="publicWorks">Public Works</option>
                <option data-translate="selfConstituency">Self Constituency</option>
            </select>
        </div>

        <div class="col-md-6">
          <label class="form-label" data-translate="applicationType">Application Type</label>
          <select class="form-select" id="applicationType" required>
            <option disabled selected>Select Type</option>
            <option>General</option>
            <option>VIP</option>
            <option>VIP 1</option>
            <option>VIP 2</option>
            <option>VIP 3</option>
            <!-- Add up to VIP 20+ -->
            <option>VIP 20</option>
            <option>VIP 21</option>
            <option>VIP 22</option>
          </select>
          
        </div>

        <div class="col-md-6">
            <label class="form-label" data-translate="uploadAttachment">Upload Attachment</label>
            <input type="file" class="form-control" id="attachment" required>

        </div>

        

      <div class="text-center mt-4">
        <!-- Generate PDF Button -->
    <button type="button" id="generate-pdf" class="btn btn-primary mt-3 px-5">
      <i class="bi bi-file-earmark-pdf"></i> Generate PDF
    </button>
        <button type="submit" class="btn btn-success mt-3 px-5">
            <i class="bi bi-check-circle me-2"></i> <span data-translate="submitBtn">Submit Application</span>
        </button>
      </div>
    </form>
  </div>
</div>



<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- Script to generate PDF -->
<script>
  document.getElementById("generate-pdf").addEventListener("click", function() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Collect form data
    const application = {
      id: document.getElementById("appId").value,
      date: document.getElementById("date").value,
      time: document.getElementById("time").value,
      name: document.getElementById("applicantName").value,
      phone: document.getElementById("phone").value,
      subject: document.getElementById("subject").value || "",
      address: document.getElementById("address").value,
      category: document.getElementById("category").value,
      department: document.getElementById("department").value,
      applicationType: document.getElementById("applicationType").value || "",
      attachment: document.getElementById("attachment").files[0]?.name || "No file uploaded",
      image: document.getElementById("attachment").files[0]
    };

    // Initialize PDF structure
    doc.setFont("helvetica");
    doc.setFontSize(12);

    // Title of the PDF
    doc.text("Application Form", 105, 20, null, null, "center");

    // Application Information
    doc.text("Application ID: " + application.id, 20, 30);
    doc.text("Date: " + application.date, 20, 40);
    doc.text("Time: " + application.time, 20, 50);
    doc.text("Name: " + application.name, 20, 60);
    doc.text("Phone: " + application.phone, 20, 70);
    doc.text("Subject: " + application.subject, 20, 80);
    // Wrapping long address text
    const addressLines = doc.splitTextToSize("Address: " + application.address, 180); // Adjust 180 for page width
    doc.text(addressLines, 20, 90);
    doc.text("Category: " + application.category, 20, 100);
    doc.text("Department: " + application.department, 20, 110);
    doc.text("Application Type: " + application.applicationType, 20, 120);

    // Attachment info (file name)
    doc.text("Attachment: " + application.attachment, 20, 130);

    // If an image is uploaded, add it to the PDF
    if (application.image) {
      const fileReader = new FileReader();
      fileReader.onloadend = function () {
        const imgData = fileReader.result;
        doc.addImage(imgData, 'JPEG', 20, 140, 50, 50); // Adjust image size and position as needed
        doc.text("Image Uploaded", 20, 200);  // Text below the image
        doc.save("application-form.pdf");  // Save the PDF after adding image
      };
      fileReader.readAsDataURL(application.image);  // Convert image to base64 format
    } else {
      doc.save("application-form.pdf");  // Save the PDF if no image is uploaded
    }
  });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
      const randomId = 'APP' + Math.floor(1000 + Math.random() * 9000);
      document.getElementById('appId').value = randomId;
    });

    document.addEventListener("DOMContentLoaded", () => {
  // Set current date and time by default
  const currentDate = new Date().toISOString().split('T')[0]; // Get current date in YYYY-MM-DD format
  const currentTime = new Date().toTimeString().split(' ')[0].substring(0, 5); // Get current time in HH:MM format

  // Set the value of the date and time input fields
  document.getElementById('date').value = currentDate;
  document.getElementById('time').value = currentTime;

  // Set application ID
  const randomId = 'APP' + Math.floor(1000 + Math.random() * 9000);
  document.getElementById('appId').value = randomId;
});

  
    document.getElementById('appForm').addEventListener('submit', function (e) {
      e.preventDefault();
  
      // Get data from form
      const application = {
        id: document.getElementById("appId").value,
        date: document.getElementById("date").value,
        time: document.getElementById("time").value,
        name: document.getElementById("applicantName").value,
        phone: document.getElementById("phone").value,
        subject: document.getElementById("subject")?.value || "",
        address: document.getElementById("address").value,
        category: document.getElementById("category").value,
        department: document.getElementById("department").value,
        applicationType: document.getElementById("applicationType")?.value || "",
         attachment: document.getElementById("attachment").files[0]?.name || "No file uploaded",
        stage: "Received",
        createdAt: new Date().toLocaleString(),
        updatedBy: "",
        updatedAt: ""
      };
  
      // Get existing applications or create new array
      const applications = JSON.parse(localStorage.getItem("applications") || "[]");
  
      // Add new application
      applications.push(application);
  
      // Save back to localStorage
      localStorage.setItem("applications", JSON.stringify(applications));
  
      alert("Application submitted successfully!");
  
      // Reset form
      this.reset();
  
      // Generate new App ID
      const newId = 'APP' + Math.floor(1000 + Math.random() * 9000);
      document.getElementById('appId').value = newId;
    });
  </script>
  
<script src="Assets/Language/i18n.js"></script>
<script>
  // Redirect to login if user is not logged in
  if (!localStorage.getItem("user")) {
    window.location.href = "index.html";
  }

  // Disable back button after logout
  window.history.pushState(null, "", window.location.href);
  window.onpopstate = function () {
    window.history.pushState(null, "", window.location.href);
  };
</script>

<script>
  document.getElementById("logoutBtn").addEventListener("click", function (e) {
    e.preventDefault();

    // Clear any session/local storage if needed
    localStorage.clear();
    sessionStorage.clear();

    // Redirect to login page
    window.location.href = "index.html"; // Replace with your actual login page
  });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


</body>
</html>
