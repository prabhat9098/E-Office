<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>माननीय मंत्री.श्री संजय शिरसाठ यांचे कार्यालय: ई-ऑफिस - Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
        font-family: "Segoe UI", sans-serif;
      }
      .login-container {
        height: 100vh;
        display: flex;
      }
      .login-img {
        background: url("assets/images/person.jpg") no-repeat center center;
        background-size: cover;
        flex: 1;
      }
      
      .login-form {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #ffffff;
      }
      .form-box {
        width: 80%;
        max-width: 400px;
      }
      @media (max-width: 768px) {
        .login-container {
          flex-direction: column;
        }

        .login-img {
          height: 350px; /* Adjust as needed */
          flex: none;
          width: 100%;
        }

        .login-form {
          flex: none;
          width: 100%;
        }
        
      }
    </style>
  </head>
  <body>
    <!-- Heading Section -->
    
    <div class="login-container">
      <div class="login-img d-flex flex-column justify-content-end text-center text-white p-3">
        <div class="bg-dark bg-opacity-50 rounded-3 p-2">
          <h5 class="mb-1" style="font-weight: bold;">मा. मंत्री. श्री. संजय शिरसाठ</h5>
          <small>(समाज कल्याण विभाग तथा पालकमंत्री छत्रपती संभाजीनगर)</small>
        </div>
      </div>
      
      <div class="login-form">
        
        <div class="form-box">
          <h4 class="text-center mb-5 mt-2" data-translate="heading">माननीय मंत्री.श्री संजय शिरसाठ यांचे कार्यालय: ई-ऑफिस</h4>
          <h3 class="mb-3 text-center" id="loginHeader" data-translate="adminLoginHeading">Admin Management Login</h3>

          <div class="d-flex align-items-center gap-3">
            <select id="languageSelect" class="form-select form-select-sm">
              <option value="en" data-translate="English">English</option>
              <option value="hi" data-translate="हिन्दी">हिन्दी</option>
              <option value="mr" data-translate="मराठी">मराठी</option>
            </select>
          </div>

          <!-- Switch for Admin/User -->
          <div class="form-check form-switch mb-4 text-end">
            <input
              class="form-check-input"
              type="checkbox"
              id="loginModeSwitch"
            />
            <label class="form-check-label" for="loginModeSwitch" id="switchLabel" data-translate="switchToUserLogin">Switch to User Login</label>
          </div>

          <!-- Admin Login -->
          <div id="adminLogin">
            <div class="mb-3">
              <label class="form-label" id="adminEmailLabel" data-translate="emailLabel">Email</label>
              <input
                type="email"
                class="form-control"
                id="adminEmail"
                placeholder="Enter email"
              />
            </div>
            <div class="mb-3">
              <label class="form-label" id="adminPasswordLabel" data-translate="passwordLabel">Password</label>
              <input
                type="password"
                class="form-control"
                id="adminPassword"
                placeholder="Enter password"
              />
            </div>
            <button class="btn btn-primary w-100" onclick="adminLogin()" data-translate="loginBtn">
              Login
            </button>
          </div>

          <!-- User Login -->
          <div id="userLogin" style="display: none">
            <div class="mb-3">
              <label class="form-label" id="phoneLabel" data-translate="phoneNumberLabel">Phone Number</label>
              <input
                type="text"
                class="form-control"
                id="phoneNumber"
                placeholder="Enter your registered phone number"
                maxlength="10"
              />
              <div id="phoneError" class="text-danger mt-1" style="font-size: 0.9rem;"></div>
            </div>
            <button
              class="btn btn-success w-100"
              id="getOtpBtn"
              onclick="sendOtp()"
              disabled
              data-translate="getOtpBtn"
            >
              Get OTP
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- OTP Modal -->
    <div
      class="modal fade"
      id="otpModal"
      tabindex="-1"
      aria-labelledby="otpModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-3">
          <h5 class="modal-title" id="otpModalLabel">Enter OTP</h5>
          <div class="modal-body">
            <input
              type="text"
              class="form-control mb-3"
              id="otpInput"
              placeholder="Enter OTP"
            />
            <button class="btn btn-primary w-100" onclick="verifyOtp()">
              Verify OTP
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
      <div id="toastMessage" class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body" id="toastText">
            <!-- Toast message here -->
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>
    </div>

    <script src="Assets/Language/i18n.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="Services/toast.js"></script>
    <script src="Apis/adminLogin.js"></script>

    <script>
      const mockDatabase = ["9876543210", "9123456789"]; // Mocked valid phone numbers
      let generatedOtp = "";

      // Redirect if already logged in
        if (localStorage.getItem("user")) {
          const userType = localStorage.getItem("usertype"); // Retrieve the user type
          if (userType === "admin") {
            window.location.href = "dashboard.html"; // Redirect to the Admin dashboard
          } else if (userType === "user") {
            window.location.href = "UserTypeApplicationform.html"; // Redirect to User's application form
          }
        }


      // Toggle login mode
      document
        .getElementById("loginModeSwitch")
        .addEventListener("change", function () {
          const isUser = this.checked;
          document.getElementById("adminLogin").style.display = isUser
            ? "none"
            : "block";
          document.getElementById("userLogin").style.display = isUser
            ? "block"
            : "none";

          // Update the header and switch text
          const loginHeader = document.getElementById("loginHeader");
          const switchLabel = document.getElementById("switchLabel");

          if (isUser) {
            loginHeader.textContent = "Office Management Login";
            switchLabel.textContent = "Switch to Admin Login";
            
          } else {
            loginHeader.textContent = "Admin Management Login";
            switchLabel.textContent = "Switch to User Login";
          }
        });

      

      // Real-time phone validation
      document.getElementById("phoneNumber").addEventListener("input", function () {
        const number = this.value.trim();
        const errorDiv = document.getElementById("phoneError");
        const otpBtn = document.getElementById("getOtpBtn");

        if (number.length === 10) {
          if (!number.match(/^\d{10}$/)) {
            errorDiv.textContent = "Please enter only numeric digits.";
            otpBtn.disabled = true;
          } else if (!mockDatabase.includes(number)) {
            errorDiv.textContent = "You are not a registered user. Please contact admin.";
            otpBtn.disabled = true;
          } else {
            errorDiv.textContent = "";
            otpBtn.disabled = false;
          }
        } else {
          errorDiv.textContent = number.length > 0 ? "Enter a 10-digit number." : "";
          otpBtn.disabled = true;
        }
      });


      // Send OTP
      function sendOtp() {
        generatedOtp = Math.floor(100000 + Math.random() * 900000).toString();
        alert("Mock OTP sent: " + generatedOtp); // Replace this with Fast2SMS API call
        new bootstrap.Modal(document.getElementById("otpModal")).show();
      }

      // Verify OTP
      function verifyOtp() {
      const enteredOtp = document.getElementById("otpInput").value.trim();
      if (enteredOtp === generatedOtp) {
        const phone = document.getElementById("phoneNumber").value.trim();
        localStorage.setItem("user", phone);
        localStorage.setItem("usertype", "user"); // <-- Add this line
        sessionStorage.setItem("user", phone);
        window.location.href = "UserTypeApplicationform.html";
      } else {
        alert("Incorrect OTP. Try again.");
      }
    }

    </script>
  </body>
</html>
